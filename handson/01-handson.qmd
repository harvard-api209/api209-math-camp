---
title: "Mastering Data Manipulation in R"
date: "2024-08-14"
format: html
engine: knitr
filters:
  - webr
webr:
  packages:
    - ggplot2
    - dplyr
    - scales
    - gapminder
    - janitor
  cell-options:
    editor-font-scale: 0.8
    fig-width: 7
    fig-height: 4.3
    out-width: "100%"
---

```{r slides-videos, echo=FALSE, include=FALSE}
source(here::here("R", "slide-things.R"))
library(tidyverse)
```

## Migration Data

The data on immigrant and emigrant stocks used in this session is sourced from the United Nations Department of Economic and Social Affairs (UN DESA).

### How does the UN define a migrant?

According to the United Nations Population Division, an international migrant is someone who has been living for one year or longer in a country other than the one in which they were born. This definition includes many foreign workers and international students, as well as refugees and, in some cases, their descendants (such as Palestinians born in refugee camps outside of the Palestinian territories). Estimates of unauthorized immigrants living in various countries are also included in these totals.

Tourists, foreign-aid workers, temporary workers employed abroad for less than a year, and overseas military personnel are typically not counted as migrants.

## Loading and Cleaning the Data

Let's begin by loading our data using the read_csv function:

```{webr-r}
#| label: load-data
migration <- read.csv("https://raw.githubusercontent.com/harvard-api209/api209-math-camp/main/files/data/external_data/migration.csv") |> 
    as_tibble()
```

We can use the `glimpse()` fucntion to check our columns (variables):

```{webr-r}
#| label: glimpse
migration |> 
    glimpse()
```

And, then, we are going to use the `janitor` package to clean the name of the variables using the `clean_names()` function:

```{webr-r}
migration <- migration |> 
    clean_names()

# and check again the names
migration |> 
    glimpse()
```

### Exercise 1

Let's ignore specifics regarding whether we have countries, regions, etc. We will filter our dataset that contain only data from 1990 to 2020 and let's look into 3 countries:

::: {.panel-tabset}
## {{< fa code >}}&ensp;Interactive editor

```{webr-r}
migration_filtered <- migration |>
  filter(year >= 1990 & year <= 2020) |> 
  filter(country %in% c(""))
```

## {{< fa lightbulb >}}&ensp;Hint

**Hint:** You'll want to change something in the code that creates `migration_filtered`. 
:::

### Exercise 2

With your filtered data, use the `summarize` function to calculate the total number of migrants for each country from 1990 to 2020.

::: {.panel-tabset}
## {{< fa code >}}&ensp;Interactive editor

```{webr-r}
migration_filtered |>
    group_by()
    summarize()
```

## {{< fa lightbulb >}}&ensp;Hint

**Hint:** Be careful! There could be missing values!
:::


## Overview

This session will focus on advanced data manipulation techniques using R and the tidyverse.

## Data wrangling


