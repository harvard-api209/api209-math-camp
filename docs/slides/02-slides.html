<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Tidy Data and Visualization</title>
    <meta charset="utf-8" />
    <meta name="author" content="Rony Rodrigo Maximiliano Rodriguez-Ramirez" />
    <meta name="date" content="2024-08-20" />
    <script src="libs/header-attrs-2.28/header-attrs.js"></script>
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link href="libs/panelset-0.3.0/panelset.css" rel="stylesheet" />
    <script src="libs/panelset-0.3.0/panelset.js"></script>
    <script src="libs/clipboard-2.0.6/clipboard.min.js"></script>
    <link href="libs/xaringanExtra-clipboard-0.2.6/xaringanExtra-clipboard.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-clipboard-0.2.6/xaringanExtra-clipboard.js"></script>
    <script>window.xaringanExtraClipboard(null, {"button":"Copy Code","success":"Copied!","error":"Press Ctrl+C to Copy"})</script>
    <link href="libs/tile-view-0.2.6/tile-view.css" rel="stylesheet" />
    <script src="libs/tile-view-0.2.6/tile-view.js"></script>
    <link href="libs/shareon-1.4.1/shareon.min.css" rel="stylesheet" />
    <script src="libs/shareon-1.4.1/shareon.min.js"></script>
    <link href="libs/xaringanExtra-shareagain-0.2.6/shareagain.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-shareagain-0.2.6/shareagain.js"></script>
    <link rel="stylesheet" href="css/ath-slides.css" type="text/css" />
    <link rel="stylesheet" href="css/ath-inferno-fonts.css" type="text/css" />
    <link rel="stylesheet" href="css/animate.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">






class: center middle main-title section-title-4

# Tidy Data and Visualization

.class-info[

**Lesson 2**

.light[API 209: Advanced Quantative Methods&lt;br&gt;
TF: Rony Rodriguez-Ramirez&lt;br&gt;
Summer 2024]

]

---

layout: false
name: tidy-data
class: center middle section-title section-title-crimson

# Recap and Tidy Data

---

layout: true
class: title title-crimson

---

# Wrangling your data {Recap}


* You are ***highly encouraged*** to read through [Hadley Wickham's chapter](https://r4ds.had.co.nz/transform.html). It's clear and concise.

* Also check out this great "cheatsheet" [here](https://github.com/rstudio/cheatsheets/blob/master/data-transformation.pdf).

* The package is organized around a set of **verbs**, i.e. *actions* to be taken.

* All *verbs* work as follows:

`$$\text{verb}(\underbrace{\text{data.frame}}_{\text{1st argument}}, \underbrace{\text{what to do}}_\text{2nd argument})$$`

* Alternatively you can (should) use the `pipe` operator `%&gt;%`:

`$$\underbrace{\text{data.frame}}_{\text{1st argument}} \underbrace{\text{ %&gt;% }}_{\text{"pipe" operator}} \text{verb}(\underbrace{\text{what to do}}_\text{2nd argument})$$`


---

# Tidy data


- In most cases, your datasets won't be `tidy`. 

&gt; **Tidy data**: A dataset is said to be tidy if it satisfies the following conditions: 

&lt;img src="https://cdn.myportfolio.com/45214904-6a61-4e23-98d6-b140f8654a40/85520b8f-4629-4763-8a2a-9ceff27458bf_rw_1920.jpg?h=21007b20ac00cf37318dca645c215453" width="60%" style="display: block; margin: auto;" /&gt;

---

# Untidy data is pretty common

.center[

![](img/02/bad-data.png)

]

However, storing data in wide form is easier to display in a printed table. 

---
layout: false
class: center middle

.huge[
  .box-crimson[Tidy] data&lt;br&gt;is data in&lt;br&gt;.box-crimson[long] format
]

---

layout: false
name: beautiful-visualizations
class: center middle section-title section-title-crimson

# Beautiful visualizations

---

layout: false
class: center middle

&lt;img src="img/02/01_dubois_georgia_negro_budget.jpg" width="70%" style="display: block; margin: auto;" /&gt;

---

layout: true
class: title title-crimson

---

# What makes a great visualization?

.box-inv-6.medium[Truthful]

.box-inv-6.medium[Functional]

.box-inv-6.medium[Beautiful]

.box-inv-6.medium[Insightful]

.box-inv-6.medium[Enlightening]

.box-6.tiny[Alberto Cairo, *The Truthful Art*]

???

Alberto Cairo, *The Truthful Art*:

&gt; 1. It is truthful, as it’s based on thorough and honest research.
&gt; 
&gt; 2. It is functional, as it constitutes an accurate depiction of the data, and it’s built in a way that lets people do meaningful operations based on it (seeing change in time).
&gt; 
&gt; 3. It is beautiful, in the sense of being attractive, intriguing, and even aesthetically pleasing for its intended audience—scientists, in the first place, but the general public, too.
&gt; 
&gt; 4. It is insightful, as it reveals evidence that we would have a hard time seeing otherwise.
&gt; 
&gt; 5. It is enlightening because if we grasp and accept the evidence it depicts, it will change our minds for the better.

---

# How do we express visuals in words?

- **Data** to be visualized

- **.hlb[Geom]etric objects** that appear on the plot

- **.hlb[Aes]thetic mappings** from data to visual component

- **.hlb[Stat]istics** transform data on the way to visualization

- **.hlb[Coord]inates** organize location of geometric objects

- **.hlb[Scale]s** define the range of values for aesthetics

- **.hlb[Facet]s** group into subplots


---

# What makes a great visualization?

.box-inv-6.medium[Good aesthetics]


.box-inv-6.medium[No substantive issues]


.box-inv-6.medium[No perceptual issues]


.box-inv-6.medium[Honesty + good judgment]

.box-6.tiny[Kieran Healy, *Data Visualization: A Practical Introduction*]

---

# You see bad plots everywhere: What's wrong?

.center[
&lt;figure&gt;
  &lt;img src="img/02/ireland-wrong.png" width="40%"&gt;
&lt;/figure&gt;
]

???

- Aesthetic issues
- Substantive issues
- Perceptual issues
- Honesty + judgment issues

---

# Is this right?

.center[
&lt;figure&gt;
  &lt;img src="img/02/Fig-ireland-olympics.png" width="80%"&gt;
&lt;/figure&gt;
]

---

layout: false
name: ggplot
class: center middle section-title section-title-crimson

# Entering ggplot

---

layout: true
class: title title-crimson

---

# ggplot

.pull-left[
For this session, you’ll use the ggplot2 package from the tidyverse meta-package.

- So, you can just load the `tidyverse` package when using ggplot.
]

.pull-right[
1. Consistency with the [**Grammar of Graphics**](https://www.springer.com/gp/book/9780387245447)
  * This book is the foundation of several data viz applications: 
  
  `ggplot2, polaris-tableau, vega-lite`
2. Flexibility
3. Layering and theme customization
4. Community

It is a powerful and easy to use tool (once you understand its logic) that produces complex and multifaceted plots.
]


---

# ggplot2: basic structure (template)

The basic ggplot structure is:


```
ggplot(data = DATA) +
  GEOM_FUNCTION(mapping = aes(AESTHETIC MAPPINGS))
```

--

.center[Mapping data to aesthetics]

.box-7[Think about colors, sizes, x and y references]

.center[We are going to learn how we connect our data to the components of a ggplot.] 

--

.center[I usually code like this:]

```
DATA |&gt; 
  ggplot(aes(AESTHETIC MAPPINGS)) +
  GEOM_FUNCTION()
```

---

# Mapping

&lt;center&gt;
Mappings do not directly specify the particular, e.g., colors, shapes, or line styles that will appear on the plot. Rather, they establish which variables in the data will be represented by which visible elements on the plot.
&lt;/center&gt;

---

# ggplot2: full structure

.pull-left[
```
ggplot(data = &lt;DATA&gt;) +
  &lt;GEOM_FUNCTION&gt;(
     mapping = aes(&lt;MAPPINGS&gt;),
     stat = &lt;STAT&gt;,
     position = &lt;POSITION&gt;
  ) +z
  &lt;COORDINATE_FUNCTION&gt; +
  &lt;FACET_FUNCTION&gt; +
  &lt;SCALE_FUNTION&gt; +
  &lt;THEME_FUNCTION&gt;

```
]

.pull-right[

.small[
1. `Data`: The data that you want to visualize
2. `Layers`: geom\_ and stat\_ → The geometric shapes and statistical summaries representing the data
3. `Aesthetics`: aes() → Aesthetic mappings of the geometric and statistical objects
4. `Scales`: scale_ → Maps between the data and the aesthetic dimensions
5. `Coordinate system`: coord_ → Maps data into the plane of the data rectangle
6. `Facets`: facet_ → The arrangement of the data into a grid of plots
7. `Visual themes`: theme() and theme_ → The overall visual defaults of a plot
]

]

---

# ggplot2: decomposition

.pull-left[

**There are multiple ways to structure plots with ggplot**

For this presentation, I will stick to Thomas Lin Pedersen's decomposition who is one of most prominent developers of the ggplot and gganimate package.&lt;br&gt;&lt;br&gt;These components can be seen as layers, this is why we use the `+` sign in our ggplot syntax.

]

.pull-right[

![](img/02/ggplot_decom.png)
]

---

# Exploratory Analysis

The most common `geoms` are:


* `geom_bar()`, `geom_col()`: bar charts.
* `geom_boxplot()`: box and whiskers plots.
* `geom_density()`: density estimates.
* `geom_jitter()`: jittered points.
* `geom_line()`: line plots.
* `geom_point()`: scatter plots.


&gt; If you want to know more about layers, you can refer to [this](https://ggplot2.tidyverse.org/reference/).

---

# Step by step from Garrick Aden-Buie's gentle guide

Using the `gapminder` package, let's start with `lifeExp` vs `gdpPercap`


```
Rows: 1,704
Columns: 6
$ country   &lt;fct&gt; "Afghanistan", "Afghanistan", "Afghanistan", "Afghanistan", …
$ continent &lt;fct&gt; Asia, Asia, Asia, Asia, Asia, Asia, Asia, Asia, Asia, Asia, …
$ year      &lt;int&gt; 1952, 1957, 1962, 1967, 1972, 1977, 1982, 1987, 1992, 1997, …
$ lifeExp   &lt;dbl&gt; 28.801, 30.332, 31.997, 34.020, 36.088, 38.438, 39.854, 40.8…
$ pop       &lt;int&gt; 8425333, 9240934, 10267083, 11537966, 13079460, 14880372, 12…
$ gdpPercap &lt;dbl&gt; 779.4453, 820.8530, 853.1007, 836.1971, 739.9811, 786.1134, …
```

---
class: fullscreen
layout: true
---

.left-code[

``` r
ggplot(gapminder) 
```
]

.right-plot[
![](02-slides_files/figure-html/gapminder-le-gdp-0-1.png)
]

The Canvas

---

.left-code[

``` r
ggplot(gapminder) +
  aes(x = gdpPercap)
```
]

.right-plot[
![](02-slides_files/figure-html/gapminder-le-gdp-0a-1.png)
]

The Canvas

---

.left-code[

``` r
ggplot(gapminder) +
  aes(x = gdpPercap,
      y = lifeExp)
```
]

.right-plot[
![](02-slides_files/figure-html/gapminder-le-gdp-1-1.png)
]

--

Add points...

---

.left-code[

``` r
ggplot(gapminder) +
  aes(x = gdpPercap,
      y = lifeExp) +
* geom_point()
```
]

.right-plot[
![](02-slides_files/figure-html/gapminder-le-gdp-2-1.png)
]

--

How can I tell countries apart?

---

.left-code[

``` r
ggplot(gapminder) +
  aes(x = gdpPercap,
      y = lifeExp,
*     color = continent) +
  geom_point()
```
]

.right-plot[
![](02-slides_files/figure-html/gapminder-le-gdp-3-1.png)
]

--

GDP is squished together on the left

---

.left-code[

``` r
ggplot(gapminder) +
  aes(x = gdpPercap,
      y = lifeExp,
      color = continent) +
  geom_point() +
* scale_x_log10()
```
]

.right-plot[
![](02-slides_files/figure-html/gapminder-le-gdp-4-1.png)
]

--

Still lots of overlap in the countries...

---

.left-code[

``` r
ggplot(gapminder) +
  aes(x = gdpPercap,
      y = lifeExp,
      color = continent) +
  geom_point() +
  scale_x_log10() +
* facet_wrap(~ continent) +
* guides(color = FALSE)
```

No need for color legend thanks to facet titles
]

.right-plot[
![](02-slides_files/figure-html/gapminder-le-gdp-5-1.png)
]

--

Lots of overplotting due to point size

---

.left-code[

``` r
ggplot(gapminder) +
  aes(x = gdpPercap,
      y = lifeExp,
      color = continent) +
* geom_point(size = 0.25) +
  scale_x_log10() +
  facet_wrap(~ continent) +
  guides(color = FALSE)
```
]

.right-plot[
![](02-slides_files/figure-html/gapminder-le-gdp-6-1.png)
]

--

Is there a trend?

---

.left-code[

``` r
ggplot(gapminder) +
  aes(x = gdpPercap,
      y = lifeExp,
      color = continent) +
* geom_line() +
  geom_point(size = 0.25) +
  scale_x_log10() +
  facet_wrap(~ continent) +
  guides(color = FALSE)
```
]

.right-plot[
![](02-slides_files/figure-html/gapminder-le-gdp-7-1.png)
]

--

Okay, that line just connected all of the points sequentially...

---

.left-code[

``` r
ggplot(gapminder) +
  aes(x = gdpPercap,
      y = lifeExp,
      color = continent) +
  geom_line(
*   aes(group = country)
  ) +
  geom_point(size = 0.25) +
  scale_x_log10() +
  facet_wrap(~ continent) +
  guides(color = FALSE)
```

.font200.center[&amp;#x1F914;]
]

.right-plot[
![](02-slides_files/figure-html/gapminder-le-gdp-8-1.png)
]

--

&amp;#x1F4A1; We need time on x-axis!

---

.left-code[

``` r
ggplot(gapminder) +
* aes(x = year,
*     y = gdpPercap,
      color = continent) +
  geom_line(
    aes(group = country)
  ) +
  geom_point(size = 0.25) +
* scale_y_log10() +
  facet_wrap(~ continent) +
  guides(color = FALSE)
```
]

.right-plot[
![](02-slides_files/figure-html/gapminder-gdp-year-1-1.png)
]

---

layout: true
class: title title-crimson

---

# Time to code

.center[
&lt;iframe src="https://giphy.com/embed/2IudUHdI075HL02Pkk" width="480" height="360" style="" frameBorder="0" class="giphy-embed" allowFullScreen&gt;&lt;/iframe&gt;&lt;p&gt;&lt;a href="https://giphy.com/gifs/pudgypenguins-data-code-coding-2IudUHdI075HL02Pkk"&gt;via GIPHY&lt;/a&gt;&lt;/p&gt;
]


---

# Our goal


&lt;img src="img/02/data-viz.png" width="75%" style="display: block; margin: auto;" /&gt;
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="libs/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9",
"navigation": {
"scroll": false
}
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
