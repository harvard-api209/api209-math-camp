{
  "hash": "9d7466d528fb038b7bbadb665837eb0c",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"<font style='font-size:1em;'>Week 02<br/>Tidy Data and Visualization</font>\"\nsubtitle: \"API209: Summer Math Camp\"\nformat: \n  clean-api-revealjs:\n    self-contained: true\n    highlight-style: breeze\nhtml-math-method:\n  method: mathjax\n  url: \"https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js\"\nauthor:\n  - name: Rony Rodrigo Maximiliano Rodriguez-Ramirez\n    email: rrodriguezramirez@g.harvard.edu\n    affiliations: \"Harvard University\"\ndate: 20 August 2024    \n---\n\n\n\n\n\n# Recap and Tidy Data\n\n## Wrangling your data {Recap}\n\n\n:::{.small}\n* You are ***highly encouraged*** to read through [Hadley Wickham's chapter](https://r4ds.had.co.nz/transform.html). It's clear and concise.\n\n* Also check out this great \"cheatsheet\" [here](https://github.com/rstudio/cheatsheets/blob/master/data-transformation.pdf).\n\n* The package is organized around a set of **verbs**, i.e. *actions* to be taken.\n\n* All *verbs* work as follows:\n\n$$\\text{verb}(\\underbrace{\\text{data.frame}}_{\\text{1st argument}}, \\underbrace{\\text{what to do}}_\\text{2nd argument})$$\n\n* Alternatively you can (should) use the `pipe` operator `%>%`:\n\n$$\\underbrace{\\text{data.frame}}_{\\text{1st argument}} \\underbrace{\\text{ %>% }}_{\\text{\"pipe\" operator}} \\text{verb}(\\underbrace{\\text{what to do}}_\\text{2nd argument})$$\n:::\n\n## Tidy data\n\n- In most cases, your datasets won't be `tidy`. \n\n> **Tidy data**: A dataset is said to be tidy if it satisfies the following conditions: \n\n![](https://cdn.myportfolio.com/45214904-6a61-4e23-98d6-b140f8654a40/85520b8f-4629-4763-8a2a-9ceff27458bf_rw_1920.jpg?h=21007b20ac00cf37318dca645c215453){.nostretch fig-align=\"center\" width=\"60%\"}\n\n## Untidy data is pretty common\n\n![](img/bad-data.png){.nostretch fig-align=\"center\" width=\"80%\"}\n\n\nHowever, storing data in wide form is easier to display in a printed table. \n\n## \n\n:::{.huge}\n:::{.center-txt}\n [Tidy data]{.fg-red}<br />is data in<br />[long]{.fg-red} format  \n:::\n:::\n\n# Beautiful visualizations\n\n## \n\n![](img/01_dubois_georgia_negro_budget.jpg){.nostretch fig-align=\"center\" width=\"80%\"}\n\n\n## What makes a great visualization?\n\n:::{.center-txt}\n[Truthful]{.box-inv-crimson}\n\n[Functional]{.box-inv-crimson}\n\n[Beautiful]{.box-inv-crimson}\n\n[Insightful]{.box-inv-crimson}\n\n[Enlightening]{.box-inv-crimson}\n\n[Alberto Cairo, *The Truthful Art*]{.box-inv-crimson-sma}\n:::\n\n## How do we express visuals in words?\n\n- **Data** to be visualized\n\n- **[Geom]{.alert}etric objects** that appear on the plot\n\n- **[Aes]{.alert}thetic mappings** from data to visual component\n\n- **[Stat]{.alert}istics** transform data on the way to visualization\n\n- **[Coord]{.alert}inates** organize location of geometric objects\n\n- **[Scale]{.alert}s** define the range of values for aesthetics\n\n- **[Facet]{.alert}s** group into subplots\n\n## What makes a great visualization?\n\n:::{.center-txt}\n[Good aesthetics]{.box-inv-crimson-med}\n\n[No substantive issues]{.box-inv-crimson-med}\n\n[No perceptual issues]{.box-inv-crimson-med}\n\n[Honesty + good judgment]{.box-inv-crimson-med}\n\n[Kieran Healy, *Data Visualization: A Practical Introduction*]{.box-inv-crimson-small}\n:::\n\n## You see bad plots everywhere: What's wrong?\n\n<center>\n  <img src=\"img/ireland-wrong.png\" width=\"50%\">\n</center>\n\n## Is this right?\n\n<center>\n  <img src=\"img/Fig-ireland-olympics.png\" width=\"80%\">\n</center>\n\n# Entering ggplot\n\n## ggplot\n\n:::: {.columns}\n\n::: {.column}\n::: {.small}\nFor this session, you’ll use the ggplot2 package from the tidyverse meta-package.\n\n- So, you can just load the `tidyverse` package when using ggplot.\n:::\n:::\n\n::: {.column}\n::: {.small}\n1. Consistency with the [**Grammar of Graphics**](https://www.springer.com/gp/book/9780387245447)\n    * This book is the foundation of several data viz applications: \n    `ggplot2, polaris-tableau, vega-lite`\n2. Flexibility\n3. Layering and theme customization\n4. Community\n\nIt is a powerful and easy to use tool (once you understand its logic) that produces complex and multifaceted plots.\n:::\n:::\n::::\n\n## ggplot2: basic structure (template)\n\nThe basic ggplot structure is:\n\n```\nggplot(data = DATA) +\n  GEOM_FUNCTION(mapping = aes(AESTHETIC MAPPINGS))\n```\n\n::: {.fragment}\n[Mapping data to aesthetics]{.small}\n:::\n::: {.fragment}\n[Think about colors, sizes, x and y references]{.small}\n:::\n::: {.fragment}\n[We are going to learn how we connect our data to the components of a ggplot.]{.small} \n:::\n::: {.fragment}\n[I usually code like this:]{.small}\n```\nDATA |> \n  ggplot(aes(AESTHETIC MAPPINGS)) +\n  GEOM_FUNCTION()\n```\n:::\n\n## Mapping\n\n<center>\n[Mappings]{.fg-red} do not directly specify the particular, e.g., colors, shapes, or line styles that will appear on the plot. \n\nRather, they establish which variables in the data will be represented by which visible elements on the plot.\n</center>\n\n## ggplot2: full structure\n\n:::: {.columns}\n\n::: {.column}\n```\nggplot(data = <DATA>) +\n  <GEOM_FUNCTION>(\n     mapping = aes(<MAPPINGS>),\n     stat = <STAT>,\n     position = <POSITION>\n  ) +z\n  <COORDINATE_FUNCTION> +\n  <FACET_FUNCTION> +\n  <SCALE_FUNTION> +\n  <THEME_FUNCTION>\n\n```\n:::\n\n::: {.column}\n::: {.tiny}\n1. `Data`: The data that you want to visualize\n2. `Layers`: geom\\_ and stat\\_ → The geometric shapes and statistical summaries representing the data\n3. `Aesthetics`: aes() → Aesthetic mappings of the geometric and statistical objects\n4. `Scales`: scale_ → Maps between the data and the aesthetic dimensions\n5. `Coordinate system`: coord_ → Maps data into the plane of the data rectangle\n6. `Facets`: facet_ → The arrangement of the data into a grid of plots\n7. `Visual themes`: theme() and theme_ → The overall visual defaults of a plot\n:::\n:::\n::::\n\n## ggplot2: decomposition\n\n:::: {.columns}\n\n::: {.column}\n\n**There are multiple ways to structure plots with ggplot**\n\n:::{.small}\nFor this presentation, I will stick to Thomas Lin Pedersen's decomposition who is one of most prominent developers of the ggplot and gganimate package.<br><br>These components can be seen as layers, this is why we use the `+` sign in our ggplot syntax.\n:::\n\n:::\n\n::: {.column}\n\n<center>\n  <img src=\"img/ggplot_decom.png\" width=\"80%\">\n</center>\n\n:::\n::::\n\n## Exploratory Analysis\n\nThe most common `geoms` are:\n\n:::{.small}\n\n* `geom_bar()`, `geom_col()`: bar charts.\n* `geom_boxplot()`: box and whiskers plots.\n* `geom_density()`: density estimates.\n* `geom_jitter()`: jittered points.\n* `geom_line()`: line plots.\n* `geom_point()`: scatter plots.\n\n:::\n\n> If you want to know more about layers, you can refer to [this](https://ggplot2.tidyverse.org/reference/).\n\n## Step by step from Garrick Aden-Buie's gentle guide\n\nUsing the `gapminder` package, let's start with `lifeExp` vs `gdpPercap`\n\n\n\n::: {.cell}\n\n```{.r .cell-code  code-line-numbers=\"1\"}\nglimpse(gapminder)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 1,704\nColumns: 6\n$ country   <fct> \"Afghanistan\", \"Afghanistan\", \"Afghanistan\", \"Afghanistan\", …\n$ continent <fct> Asia, Asia, Asia, Asia, Asia, Asia, Asia, Asia, Asia, Asia, …\n$ year      <int> 1952, 1957, 1962, 1967, 1972, 1977, 1982, 1987, 1992, 1997, …\n$ lifeExp   <dbl> 28.801, 30.332, 31.997, 34.020, 36.088, 38.438, 39.854, 40.8…\n$ pop       <int> 8425333, 9240934, 10267083, 11537966, 13079460, 14880372, 12…\n$ gdpPercap <dbl> 779.4453, 820.8530, 853.1007, 836.1971, 739.9811, 786.1134, …\n```\n\n\n:::\n:::\n\n\n\n## \n\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"1\"}\nggplot(gapminder) \n```\n\n::: {.cell-output-display}\n![](slides02_files/figure-revealjs/unnamed-chunk-2-1.png){width=960}\n:::\n:::\n\n\n\nThe Canvas\n\n##\n\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code}\nggplot(gapminder) +\n  aes(\n    x = gdpPercap\n  )\n```\n\n::: {.cell-output-display}\n![](slides02_files/figure-revealjs/unnamed-chunk-3-1.png){width=960}\n:::\n:::\n\n\n\nThe Canvas\n\n##\n\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code}\nggplot(gapminder) +\n  aes(\n    x = gdpPercap,\n    y = lifeExp\n  )\n```\n\n::: {.cell-output-display}\n![](slides02_files/figure-revealjs/unnamed-chunk-4-1.png){width=960}\n:::\n:::\n\n\n\nLet's add points...\n\n##\n\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code}\nggplot(gapminder) +\n  aes(\n    x = gdpPercap,\n    y = lifeExp\n  ) + \n  geom_point() \n```\n\n::: {.cell-output-display}\n![](slides02_files/figure-revealjs/unnamed-chunk-5-1.png){width=960}\n:::\n:::\n\n\n\n\nHow can I tell countries apart? GDP is squished together on the left\n\n##\n\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"7\"}\nggplot(gapminder) +\n  aes(\n    x = gdpPercap,\n    y = lifeExp\n  ) + \n  geom_point() +\n  scale_x_log10()\n```\n\n::: {.cell-output-display}\n![](slides02_files/figure-revealjs/unnamed-chunk-6-1.png){width=960}\n:::\n:::\n\n\n\nStill lots of overlap in the countries...\n\n##\n\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"|8|9|10\"}\nggplot(gapminder) +\n  aes(\n    x = gdpPercap,\n    y = lifeExp,\n    color = continent\n  ) +\n  geom_point() +\n  scale_x_log10() +\n  facet_wrap(~ continent) +\n  guides(color = FALSE)    \n```\n\n::: {.cell-output-display}\n![](slides02_files/figure-revealjs/unnamed-chunk-7-1.png){width=960}\n:::\n:::\n\n\n\nNo need for color legend thanks to facet titles.\n\nLots of overplotting due to point size.\n\n##\n\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code}\nggplot(gapminder) +\n  aes(\n    x = gdpPercap,\n    y = lifeExp,\n    color = continent\n  ) +\n  geom_point(size = 0.25) + \n  scale_x_log10() +\n  facet_wrap(~ continent) +\n  guides(color = FALSE)\n```\n\n::: {.cell-output-display}\n![](slides02_files/figure-revealjs/unnamed-chunk-8-1.png){width=960}\n:::\n:::\n\n\n\nIs there a trend?\n\n##\n\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code}\nggplot(gapminder) +\n  aes(\n    x = gdpPercap,\n    y = lifeExp,\n    color = continent\n  ) +\n  geom_line() + #<<\n  geom_point(size = 0.25) +\n  scale_x_log10() +\n  facet_wrap(~ continent) +\n  guides(color = FALSE)\n```\n\n::: {.cell-output-display}\n![](slides02_files/figure-revealjs/unnamed-chunk-9-1.png){width=960}\n:::\n:::\n\n\n\nOkay, that line just connected all of the points sequentially...\n\n##\n\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code}\nggplot(gapminder) +\n  aes(\n    x = gdpPercap,\n    y = lifeExp,\n    color = continent\n  ) +\n  geom_line(\n    aes(group = country)\n  ) +\n  geom_point(size = 0.25) +\n  scale_x_log10() +\n  facet_wrap(~ continent) +\n  guides(color = FALSE)\n```\n\n::: {.cell-output-display}\n![](slides02_files/figure-revealjs/unnamed-chunk-10-1.png){width=960}\n:::\n:::\n\n\n\nOh no! Too confusing!\n\n##\n\n\n\n::: {.cell output-location='column'}\n\n```{.r .cell-code  code-line-numbers=\"|3\"}\nggplot(gapminder) +\n  aes(\n    x = year,\n    y = lifeExp,\n    color = continent\n  ) +\n  geom_line(\n    aes(group = country)\n  ) +\n  geom_point(size = 0.25) +\n  scale_y_log10() +\n  facet_wrap(~ continent) +\n  guides(color = FALSE)\n```\n\n::: {.cell-output-display}\n![](slides02_files/figure-revealjs/unnamed-chunk-11-1.png){width=960}\n:::\n:::\n\n\n\nLet's add `year` in our x-axis instead of `gdp`!\n\n## Our goal\n\n<center>\n  <img src=\"img/data-viz.png\" width=\"90%\">\n</center>\n",
    "supporting": [
      "slides02_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}