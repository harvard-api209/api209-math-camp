{
  "hash": "a6153c9baf4eee57075f76f9d7c58eef",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Tutorial 5: Visualization with ggplot2\"\nformat: html\n---\n\n::: {.cell}\n\n:::\n\n\n\n\n# Visualization with ggplot2\n\nIn this tutorial, we will explore data visualization using `ggplot2`, a powerful and flexible package in the Tidyverse for creating graphics. Understanding how to visualize data effectively is crucial for analyzing and presenting your findings. We will cover the basics of creating various types of plots and customizing them to suit your needs.\n\n## 5.0 The grammar of graphics (The GG in GGPlot)\n\n### The Grammar of Graphics: An Overview\n\nThe **Grammar of Graphics** is a framework for data visualization that provides a structured and systematic approach to creating graphics. It was introduced by Leland Wilkinson in his book *The Grammar of Graphics* and serves as the foundation for `ggplot2`, a popular R package for data visualization. The key idea behind the Grammar of Graphics is that any statistical graphic can be built up from a few basic components, combined according to a set of rules. This approach allows for flexibility and consistency in creating complex visualizations.\n\n#### Key Components of the Grammar of Graphics\n\n1. **Data**: The dataset that you want to visualize. It typically consists of rows (observations) and columns (variables).\n\n2. **Aesthetics (aes)**: These are mappings between data variables and visual properties of the plot, such as position (x, y), color, size, shape, and more. For example, mapping a variable to the x-axis or mapping a variable to color.\n\n3. **Geometries (geom)**: These are the visual elements that represent data on the plot, such as points, lines, bars, or shapes. For instance, `geom_point()` creates a scatter plot, `geom_line()` creates a line plot, and `geom_bar()` creates a bar chart.\n\n4. **Scales**: Scales control how data values are mapped to aesthetic attributes like position, color, or size. For example, `scale_x_continuous()` controls the mapping of data values to positions along the x-axis.\n\n5. **Facets**: Faceting is a way to split the data into subsets and create multiple plots for each subset, allowing for comparisons across groups. For example, you can create separate plots for each level of a categorical variable.\n\n6. **Statistics (stat)**: These are transformations of the data that are applied before plotting. For example, a histogram involves binning data and then counting the number of observations in each bin.\n\n7. **Coordinates (coord)**: This component controls the coordinate system used for the plot. The most common coordinate system is Cartesian (x, y), but others include polar coordinates or log scales.\n\n8. **Themes**: Themes control the overall appearance of the plot, including non-data elements like font size, background color, grid lines, and axis labels. For example, `theme_minimal()` provides a clean, minimalistic style for the plot.\n\n### How `ggplot2` Uses the Grammar of Graphics\n\n`ggplot2` is an implementation of the Grammar of Graphics in R. It allows you to create complex visualizations by combining these basic components in a structured way. Here's how `ggplot2` uses the Grammar of Graphics:\n\n1. **Initialization with `ggplot()`**:\n   - The `ggplot()` function initializes a ggplot object and specifies the dataset you want to use. For example:\n\n\n\n     ::: {.cell}\n     \n     ```{.r .cell-code}\n     ggplot(data = students_df)\n     ```\n     :::\n\n\n\n   - This function doesn't produce a plot by itself; it sets up the plot object to which you can add layers.\n\n2. **Aesthetic Mapping with `aes()`**:\n   - Inside the `ggplot()` function or within individual geometries, you define aesthetic mappings using the `aes()` function. For example:\n\n\n\n     ::: {.cell}\n     \n     ```{.r .cell-code}\n     ggplot(data = students_df, aes(x = Age, y = Score))\n     ```\n     :::\n\n\n\n   - This mapping connects the data to the visual properties of the plot, like mapping `Age` to the x-axis and `Score` to the y-axis.\n\n3. **Adding Geometries with `geom_*()` Functions**:\n   - Geometries are added to the plot to represent the data. Each geometry corresponds to a type of plot element, such as points, lines, or bars. For example:\n\n\n\n     ::: {.cell}\n     \n     ```{.r .cell-code}\n     ggplot(data = students_df, aes(x = Age, y = Score)) +\n       geom_point()\n     ```\n     :::\n\n\n\n   - This adds a layer of points to the plot, creating a scatter plot.\n\n4. **Customizing Scales and Axes**:\n   - Scales can be customized to control how data values map to visual attributes. For example, you can adjust the x-axis limits or change the color scale:\n\n\n\n     ::: {.cell}\n     \n     ```{.r .cell-code}\n     ggplot(data = students_df, aes(x = Age, y = Score)) +\n       geom_point() +\n       scale_x_continuous(limits = c(18, 25))\n     ```\n     :::\n\n\n\n\n5. **Faceting for Multi-Panel Plots**:\n   - Faceting allows you to create multiple plots based on subsets of the data. For example:\n\n\n\n     ::: {.cell}\n     \n     ```{.r .cell-code}\n     ggplot(data = students_df, aes(x = Age, y = Score)) +\n       geom_point() +\n       facet_wrap(~ Major)\n     ```\n     :::\n\n\n\n   - This creates separate scatter plots for each `Major`.\n\n6. **Applying Themes**:\n   - Themes are used to control the appearance of non-data elements in the plot. For example:\n\n\n\n     ::: {.cell}\n     \n     ```{.r .cell-code}\n     ggplot(data = students_df, aes(x = Age, y = Score)) +\n       geom_point() +\n       theme_minimal()\n     ```\n     :::\n\n\n\n   - This applies a minimalistic style to the plot.\n\n### Mapping in ggplot2\n\nMapping in `ggplot2` refers to the connection between your data variables and the visual aspects of your plot. The `aes()` function is where this mapping happens. It tells `ggplot2` how to map your data onto the plot. Here's how mapping works:\n\n1. **Position Mapping (x and y)**:\n   - The most common type of mapping is position mapping, where you map variables to the x-axis and y-axis. For example:\n\n\n\n     ::: {.cell}\n     \n     ```{.r .cell-code}\n     ggplot(data = students_df, aes(x = Age, y = Score))\n     ```\n     :::\n\n\n\n   - This maps the `Age` variable to the x-axis and the `Score` variable to the y-axis.\n\n2. **Color Mapping**:\n   - You can map a variable to the color aesthetic to differentiate data points by a categorical or continuous variable. For example:\n\n\n\n     ::: {.cell}\n     \n     ```{.r .cell-code}\n     ggplot(data = students_df, aes(x = Age, y = Score, color = Major))\n     ```\n     :::\n\n\n\n   - This maps the `Major` variable to the color of the points, allowing different colors for different majors.\n\n3. **Size Mapping**:\n   - The size of points or other elements can be mapped to a variable. For example:\n\n\n\n     ::: {.cell}\n     \n     ```{.r .cell-code}\n     ggplot(data = student_performance_df, aes(x = Homework_Score, y = Exam_Score, size = Study_Hours))\n     ```\n     :::\n\n\n\n   - This maps the `Study_Hours` variable to the size of the points, with more study hours represented by larger points.\n\n4. **Shape Mapping**:\n   - Similarly, you can map a variable to the shape aesthetic to differentiate points by shape. For example:\n\n\n\n     ::: {.cell}\n     \n     ```{.r .cell-code}\n     ggplot(data = students_df, aes(x = Age, y = Score, shape = Gender))\n     ```\n     :::\n\n\n\n   - This maps the `Gender` variable to the shape of the points, using different shapes for male and female students.\n\n### Importance of Understanding the Grammar of Graphics\n\nUnderstanding the Grammar of Graphics is essential because it gives you a powerful, flexible, and consistent way to create visualizations. By understanding how the different components work together, you can build complex and customized plots to meet your specific data visualization needs. It also makes it easier to debug and refine your plots since you know exactly how each part of the plot is constructed.\n\n## 5.1 Introduction to ggplot2\n\n`ggplot2` is based on the grammar of graphics, which provides a structured approach to building plots by layering components such as data, aesthetics, and geometries.\n\n### 5.1.1 Tibbles and Data Frames\n\nBefore diving into ggplot2, itâ€™s important to understand the difference between **tibbles** and **data frames**.\n\n- **Tibbles** are modern versions of data frames provided by the Tidyverse, which are more user-friendly for data analysis. They provide better printing methods and do not convert strings to factors by default.\n- For now, we will continue using `data.frame` to create datasets for simplicity. However, in future tutorials, we will introduce tibbles and their advantages.\n\n### 5.1.2 Installing and Loading ggplot2\n\nIf you haven't already installed the Tidyverse, you can install `ggplot2` individually or load it as part of the Tidyverse.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Install ggplot2 (if not already installed)\ninstall.packages(\"ggplot2\")\n\n# Load ggplot2\nlibrary(ggplot2)\n```\n:::\n\n\n\n\n**Explanation:**\n- `install.packages()` installs `ggplot2` if it's not already installed.\n- `library()` loads the package, making its functions available for use.\n\n### 5.1.3 Basic Structure of a ggplot2 Plot\n\nThe basic structure of a `ggplot2` plot consists of the following components:\n- **Data**: The dataset being used.\n- **Aesthetics (aes)**: Mappings between variables and visual properties such as x and y positions, colors, sizes, etc.\n- **Geometries (geom)**: The type of plot or geometric objects used to represent the data (e.g., points, lines, bars).\n\nHere's an example of a simple scatter plot:\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Example data frame\nstudents_df <- data.frame(\n  Name = c(\"Alice\", \"Bob\", \"Charlie\", \"David\", \"Eva\"),\n  Score = c(85, 90, 78, 88, 92),\n  Age = c(20, 21, 19, 22, 20)\n)\n\n# Creating a scatter plot of Score vs. Age\nggplot(data = students_df, aes(x = Age, y = Score)) +\n  geom_point()\n```\n\n::: {.cell-output-display}\n![](05-content_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\n\n\n**Explanation:**\n- `ggplot()` initializes the plot and specifies the data to be used.\n- `aes()` defines the aesthetic mappings, such as x and y variables.\n- `geom_point()` adds a layer of points (a scatter plot) to the plot.\n\n## 5.2 Creating Different Types of Plots\n\n### 5.2.1 Scatter Plots\n\nScatter plots are used to visualize the relationship between two continuous variables.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Scatter plot with additional customizations\nggplot(data = students_df, aes(x = Age, y = Score)) +\n  geom_point(color = \"blue\", size = 3) +\n  labs(title = \"Student Scores vs. Age\", x = \"Age\", y = \"Score\")\n```\n\n::: {.cell-output-display}\n![](05-content_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\n\n\n**Explanation:**\n- The `color` and `size` arguments in `geom_point()` customize the appearance of the points.\n- `labs()` is used to add titles and labels to the axes.\n\n### 5.2.2 Bar Charts\n\nBar charts are used to compare the counts or frequencies of categorical variables.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Example data frame for bar chart\nmajors_df <- data.frame(\n  Major = c(\"Economics\", \"History\", \"Biology\"),\n  Students = c(50, 40, 30)\n)\n\n# Creating a bar chart of the number of students per major\nggplot(data = majors_df, aes(x = Major, y = Students)) +\n  geom_bar(stat = \"identity\", fill = \"skyblue\") +\n  labs(title = \"Number of Students by Major\", x = \"Major\", y = \"Number of Students\")\n```\n\n::: {.cell-output-display}\n![](05-content_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\n\n\n**Explanation:**\n- `geom_bar()` is used for creating bar charts. The `stat = \"identity\"` argument indicates that the heights of the bars should represent the values in the dataset.\n- The `fill` argument customizes the color of the bars.\n\n### 5.2.3 Line Plots\n\nLine plots are useful for visualizing trends over time or across ordered categories.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Example data frame for line plot\nyearly_scores_df <- data.frame(\n  Year = c(2018, 2019, 2020, 2021, 2022),\n  AverageScore = c(80, 82, 85, 87, 90)\n)\n\n# Creating a line plot of average scores over years\nggplot(data = yearly_scores_df, aes(x = Year, y = AverageScore)) +\n  geom_line(color = \"red\", size = 1.5) +\n  geom_point(color = \"red\", size = 3) +\n  labs(title = \"Average Scores Over Time\", x = \"Year\", y = \"Average Score\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.\nâ„¹ Please use `linewidth` instead.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](05-content_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n\n\n\n**Explanation:**\n- `geom_line()` adds a line to the plot, while `geom_point()` overlays points on the line.\n- The color and size of the line and points are customized using `color` and `size` arguments.\n\n### 5.2.4 Histograms\n\nHistograms display the distribution of a single continuous variable by dividing it into bins.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Creating a histogram of student scores\nggplot(data = students_df, aes(x = Score)) +\n  geom_histogram(binwidth = 5, fill = \"green\", color = \"black\") +\n  labs(title = \"Distribution of Student Scores\", x = \"Score\", y = \"Frequency\")\n```\n\n::: {.cell-output-display}\n![](05-content_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\n\n\n**Explanation:**\n- `geom_histogram()` creates the histogram. The `binwidth` argument controls the width of the bins.\n- The `fill` and `color` arguments customize the color of the bars and their outlines.\n\n### 5.2.5 Box Plots\n\nBox plots are used to visualize the distribution of a continuous variable and identify potential outliers.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Example data frame with Major added\nstudents_major_df <- data.frame(\n  Name = c(\"Alice\", \"Bob\", \"Charlie\", \"David\", \"Eva\"),\n  Score = c(85, 90, 78, 88, 92),\n  Age = c(20, 21, 19, 22, 20),\n  Major = c(\"Economics\", \"Economics\", \"History\", \"Biology\", \"History\")\n)\n\n# Creating a box plot of scores by major\nggplot(data = students_major_df, aes(x = Major, y = Score)) +\n  geom_boxplot(fill = \"orange\") +\n  labs(title = \"Box Plot of Scores by Major\", x = \"Major\", y = \"Score\")\n```\n\n::: {.cell-output-display}\n![](05-content_files/figure-html/unnamed-chunk-18-1.png){width=672}\n:::\n:::\n\n\n\n\n**Explanation:**\n- `geom_boxplot()` creates the box plot, which shows the median, quartiles, and potential outliers for each group.\n\n## 5.3 Customizing ggplot2 Plots\n\n### 5.3.1 Adding Themes\n\nThemes in `ggplot2` allow you to customize the overall appearance of your plots.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Applying a minimal theme to a scatter plot\nggplot(data = students_df, aes(x = Age, y = Score)) +\n  geom_point(color = \"blue\", size = 3) +\n  labs(title = \"Student Scores vs. Age\", x = \"Age\", y = \"Score\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](05-content_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n:::\n\n\n\n\n**Explanation:**\n- `theme_minimal()` applies a clean and minimalistic style to the plot. Other themes include `theme_classic()`, `theme_light()`, and more.\n\n### 5.3.2 Faceting\n\nFaceting allows you to create multiple plots based on a categorical variable.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Creating facets based on Major\nggplot(data = students_major_df, aes(x = Age, y = Score)) +\n  geom_point(color = \"purple\", size = 3) +\n  labs(title = \"Student Scores vs. Age by Major\", x = \"Age\", y = \"Score\") +\n  facet_wrap(~ Major)\n```\n\n::: {.cell-output-display}\n![](05-content_files/figure-html/unnamed-chunk-20-1.png){width=672}\n:::\n:::\n\n\n\n\n**Explanation:**\n- `facet_wrap(~ Major)` creates a separate plot for each level of the `Major` variable.\n\n### 5.3.3 Customizing Scales\n\nYou can customize the scales of your plot, including axis limits and colors.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Customizing axis limits and colors\nggplot(data = students_major_df, aes(x = Age, y = Score)) +\n  geom_point(aes(color = Major), size = 3) +\n  labs(title = \"Student Scores vs. Age\", x = \"Age\", y = \"Score\") +\n  scale_x_continuous(limits = c(18, 25)) +\n  scale_color_manual(values = c(\"Economics\" = \"blue\", \"History\" = \"red\", \"Biology\" = \"green\"))\n```\n\n::: {.cell-output-display}\n![](05-content_files/figure-html/unnamed-chunk-21-1.png){width=672}\n:::\n:::\n\n\n\n\n**Explanation:**\n- `scale_x_continuous()` sets the limits for the x-axis.\n- `scale_color\n\n_manual()` allows you to manually specify the colors for each level of the `Major` variable.\n\n## Exercises and Solutions\n\n### Exercise 1: Creating a Scatter Plot with Multiple Variables\n\n1. Create a scatter plot using a new data frame `student_performance_df` with variables `Homework_Score` and `Exam_Score` for eight students.\n2. Add a third variable `Study_Hours` to the scatter plot, mapping it to the size of the points.\n\n**Solution:**\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Creating the data frame\nstudent_performance_df <- data.frame(\n  Student = c(\"Anna\", \"Ben\", \"Cathy\", \"Derek\", \"Ella\", \"Frank\", \"Grace\", \"Hannah\"),\n  Homework_Score = c(78, 85, 92, 88, 76, 90, 82, 94),\n  Exam_Score = c(80, 87, 90, 85, 79, 92, 85, 96),\n  Study_Hours = c(10, 12, 14, 9, 8, 13, 11, 15)\n)\n\n# Creating and customizing the scatter plot\nggplot(data = student_performance_df, aes(x = Homework_Score, y = Exam_Score, size = Study_Hours)) +\n  geom_point(color = \"blue\") +\n  labs(title = \"Homework vs. Exam Scores with Study Hours\", x = \"Homework Score\", y = \"Exam Score\")\n```\n\n::: {.cell-output-display}\n![](05-content_files/figure-html/unnamed-chunk-22-1.png){width=672}\n:::\n:::\n\n\n\n\n### Exercise 2: Creating a Stacked Bar Chart\n\n1. Using a new data frame `gender_major_df`, create a stacked bar chart to visualize the number of male and female students in three different majors (Math, English, Science).\n2. Customize the colors for male and female students differently and add titles and labels.\n\n**Solution:**\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Creating the data frame\ngender_major_df <- data.frame(\n  Major = rep(c(\"Math\", \"English\", \"Science\"), each = 2),\n  Gender = rep(c(\"Male\", \"Female\"), times = 3),\n  Count = c(30, 20, 25, 15, 35, 25)\n)\n\n# Creating and customizing the stacked bar chart\nggplot(data = gender_major_df, aes(x = Major, y = Count, fill = Gender)) +\n  geom_bar(stat = \"identity\") +\n  labs(title = \"Number of Students by Major and Gender\", x = \"Major\", y = \"Number of Students\") +\n  scale_fill_manual(values = c(\"Male\" = \"blue\", \"Female\" = \"pink\"))\n```\n\n::: {.cell-output-display}\n![](05-content_files/figure-html/unnamed-chunk-23-1.png){width=672}\n:::\n:::\n\n\n\n\n### Exercise 3: Creating a Time Series Line Plot\n\n1. Create a line plot using a new data frame `monthly_sales_df` that tracks monthly sales (in thousands of dollars) for a company over a year.\n2. Add points to the line plot, customize the line type to be dashed, and label the axes appropriately.\n\n**Solution:**\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Creating the data frame\nmonthly_sales_df <- data.frame(\n  Month = factor(c(\"January\", \"February\", \"March\", \"April\", \"May\", \"June\", \"July\", \"August\", \"September\", \"October\", \"November\", \"December\"),\n                 levels = c(\"January\", \"February\", \"March\", \"April\", \"May\", \"June\", \"July\", \"August\", \"September\", \"October\", \"November\", \"December\")),\n  Sales = c(120, 130, 150, 160, 170, 180, 175, 190, 200, 210, 220, 230)\n)\n\n# Creating and customizing the time series line plot\nggplot(data = monthly_sales_df, aes(x = Month, y = Sales)) +\n  geom_line(color = \"darkgreen\", linetype = \"dashed\", size = 1.2) +\n  geom_point(color = \"darkgreen\", size = 3) +\n  labs(title = \"Monthly Sales Over a Year\", x = \"Month\", y = \"Sales (in thousands)\")\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`geom_line()`: Each group consists of only one observation.\nâ„¹ Do you need to adjust the group aesthetic?\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](05-content_files/figure-html/unnamed-chunk-24-1.png){width=672}\n:::\n:::\n\n\n\n\n### Exercise 4: Creating a Density Plot\n\n1. Using a new data frame `income_df`, create a density plot to display the distribution of income levels (in thousands of dollars) across a population of 100 individuals.\n2. Customize the density plot with a fill color and adjust the transparency.\n\n**Solution:**\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Creating the data frame\nset.seed(42)  # For reproducibility\nincome_df <- data.frame(\n  Income = c(rnorm(100, mean = 50, sd = 10))\n)\n\n# Creating and customizing the density plot\nggplot(data = income_df, aes(x = Income)) +\n  geom_density(fill = \"blue\", alpha = 0.5) +\n  labs(title = \"Distribution of Income Levels\", x = \"Income (in thousands)\", y = \"Density\")\n```\n\n::: {.cell-output-display}\n![](05-content_files/figure-html/unnamed-chunk-25-1.png){width=672}\n:::\n:::\n\n\n\n\n### Exercise 5: Creating a Violin Plot\n\n1. Using a new data frame `exam_scores_df` that includes exam scores for three different classes (Math, Science, History), create a violin plot to visualize the distribution of scores for each class.\n2. Customize the violin plot by changing the fill color and adding a title and labels.\n\n**Solution:**\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Creating the data frame\nexam_scores_df <- data.frame(\n  Class = rep(c(\"Math\", \"Science\", \"History\"), each = 50),\n  Score = c(rnorm(50, mean = 75, sd = 10), rnorm(50, mean = 80, sd = 12), rnorm(50, mean = 70, sd = 15))\n)\n\n# Creating and customizing the violin plot\nggplot(data = exam_scores_df, aes(x = Class, y = Score)) +\n  geom_violin(fill = \"purple\", color = \"black\") +\n  labs(title = \"Distribution of Exam Scores by Class\", x = \"Class\", y = \"Score\")\n```\n\n::: {.cell-output-display}\n![](05-content_files/figure-html/unnamed-chunk-26-1.png){width=672}\n:::\n:::",
    "supporting": [
      "05-content_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}